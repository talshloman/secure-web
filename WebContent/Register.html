<!DOCTYPE html>
<html>
<head>
<meta charset="windows-1255">
<title>Register</title>
<link rel="stylesheet" href="CSS/styleRegister.css">
</head>

<body>
<div class="container">
	<section id="content">
		<form name="RegisterForm" action="Register" method="Post" enctype="multipart/form-data">
		<h1>IWantSomething</h1>
			<div>
				<input type="text" placeholder="FirstName" name="FirstName" VALUE="" pattern="[A-Za-z]{1,25}" maxlength="20" required>
			</div>
			<div>
				<input type="text" placeholder="LastName" name="LastName" VALUE="" pattern="[A-Za-z]{1,25}" maxlength="20" required>
			</div>
			<div>
				<input type="text" placeholder="Username" name="UserName" VALUE="" pattern="[A-Za-z0-9_]{1,25}" maxlength="20" required onblur="checkExist()"/><span id="isE"></span>
			</div>
			<div>
				<input type="password" placeholder="Password" name="Password" VALUE="" pattern="[A-Za-z0-9_]{6,10}" required onblur="checkPassword()"/><span id="answerPassword"></span>
			</div>
			<div>
				<input type="password" placeholder="ConfirmPassword" name="ConfirmPassword" VALUE="" pattern="[A-Za-z0-9_]{6,10}" required onblur="checkEqual()"/><span id="confirmPassword"></span>
			</div>
			<div>
				Your date: <input type="date" placeholder="Birthday" name="Birthday" VALUE = "" pattern="[0-9]{2}+.[0-9]{2}+.[0-9]{4} "required style="width: 75%;">
			</div>
			
			<div>
				<input type="text" placeholder="Country" name="Country" VALUE="" pattern="[A-Za-z]{1,}" maxlength="20" required>
			</div>
			<div>
				<input type="text" placeholder="AdreesStreet" name="AdreesStreet" VALUE="" pattern="[A-Za-z\s0-9]{1,}" maxlength="20" required>
			</div>
			<div>
				<input type="text" placeholder="City" name="City" VALUE="" pattern="[A-Za-z]{1,}" maxlength ="15" required>
			</div>
			<div>
				<input type="text" placeholder="ZipCode" name="ZipCode" VALUE="" maxlength="7" pattern="[A-Za-z0-9]{1,}"required>
			</div>
			<div>
				<input type="text" placeholder="Email" name="Email" VALUE="" pattern="[a-z0-9._-]{1,}+@[a-z0-9.-]{1,}+\.[a-z]{2,3}" maxlength="100" required>
			</div>
			<div>
				Choose your picture: <input type="file" Id = "Pic" name="Pic" VALUE = "" accept="image/.,.png,.gif,.jpg"  required>
			</div>
			<div>			 
				<button TYPE="button"  Value="Register" onClick="validation (this.form);">Register</button>
			</div>
		</form>
	</section><!-- content -->
</div><!-- container -->

	 <div id="comment"></div>
<script>
	 
		 function validation (form)
		 {
			var firstName = form.FirstName.value;
			var lastName = form.LastName.value;
			var userName = form.UserName.value;
			var password = form.Password.value;
			var confirmPassword = form.ConfirmPassword.value;
			var birthday = form.Birthday.value;
			var country = form.Country.value;
			var adreesStreet = form.AdreesStreet.value;
			var city = form.City.value;
			var zipCode = form.ZipCode.value;
			var email = form.Email.value;
			var pic = form.Pic.value;
			
			
			if((checkLetter(firstName, firstName.length)) == 1)
			{
				if((checkLetter(lastName, lastName.length)) == 1)
				{
					if((checkUserName(userName, userName.length)) == 1)
					{
						if(checkPassword(password, password.length, confirmPassword) == 1)
						{
							if((checkBirthday(birthday, birthday.length)) == 1)
							{
								if((checkLetter(country, country.length)) == 1)
								{
									if((checkAdreesStreet(adreesStreet, adreesStreet.length)) == 1)
									{
										if((checkLetter(city, city.length)) == 1)
										{
											if((checkZipCode(zipCode, zipCode.length)) == 1)
											{
												if((checkEmail(email , email.length)) == 1)
												{
													if(checkPictuer(pic) == 1)
													{
														form.submit();
													}
													else
													{
													   	document.getElementById('comment').innerHTML = "The data you entered are not good";
													}
												}
												else
												{
												   	document.getElementById('comment').innerHTML = "The data you entered are not good";
												}
											}
											else
											{
											   	document.getElementById('comment').innerHTML = "The data you entered are not good";
											}
										}
										else
										{
										   	document.getElementById('comment').innerHTML = "The data you entered are not good";
										}
									}
									else
									{
									   	document.getElementById('comment').innerHTML = "The data you entered are not good";
									}
								}
								else
								{
								   	document.getElementById('comment').innerHTML = "The data you entered are not good";
								}
							}
							else
							{
							   	document.getElementById('comment').innerHTML = "The data you entered are not good";
							}
						}
						else
						{
						   	document.getElementById('comment').innerHTML = "The data you entered are not good";
						}
					}
					else
					{
					   	document.getElementById('comment').innerHTML = "The data you entered are not good";
					}
				}
				else
				{
				   	document.getElementById('comment').innerHTML = "The data you entered are not good";
				}
			}
			else
			{
			   	document.getElementById('comment').innerHTML = "The data you entered are not good";
			}
		 }
		 
		 function checkLetter(name, size)
		 {
			for(var i = 0;i < size;i++)
			{
				if (/[a-zA-Z]/.test(name[i]) == true) {
			    	return 1;
				}
			}
			
			return 0;
			}
		 
		function checkUserName(item, size)
		{
			for(var i = 0;i < size;i++){
				if (/[a-zA-Z_]/.test(item[i]) == true) 
				{
			    	return 1;
				}
			}
			
			return 0;
		}

		function checkPassword(password, size, confirmPassword)
		{
			if(size < 1 || size > 10 || password != confirmPassword)
			{
				return 0;
			}
			for(var i = 0;i < size;i++)
			{
				if (/[a-zA-Z0-9_]/.test(password[i]) == true) 
				{
			    	return 1;
				}
				
			}
			return 0;
		}
		
		function checkBirthday(birthday, size)
		{
			var pattern =/^([0-9]{2})\.([0-9]{2})\.([0-9]{4})$/;
			if(size == 10 && pattern.test(birthday))
			{
				return 1;
			}
			
			return 0;
		}
		
		function checkAdreesStreet(adreesStreet , size)
		{
			var pattern =/^([A-Za-z\s0-9]{3,20})$/;
			if(size >= 3 && size <= 16 && pattern.test(adreesStreet))
			{
				return 1;
			}
			
			return 0;
		}
		
		function checkZipCode(zipCode, size)
		{
			var pattern =/^([0-9]{2,7})$/;
			if(size >= 2 && size <= 7 && pattern.test(zipCode))
			{
				return 1;
			}
			
			return 0;
		}
		
		function checkEmail(email, size)
		{
		    var atpos = email.indexOf("@");
		    var dotpos = email.lastIndexOf(".");
		    if ( size > 4 && atpos > 1 && (dotpos - atpos) > 2 && (dotpos + 2) <= email.length) 
		    {
		        return 1;
		    }
		    
		    return 0;
		}
		
		function checkPictuer(pic)
		{
			var flagEnd = 0;
			var flagBegin = 0;
			var extensions = new Array("jpg","jpeg","gif","png","bmp");
			var pos = pic.lastIndexOf('.') + 1; 
			var ext = pic.substring(pos, pic.length); 
			var final_ext = ext.toLowerCase();
			for (i = 0; i < extensions.length; i++)
			{
			    if(extensions[i] == final_ext)
			    {
			    	flagEnd =  1;
			    }
			}
			var begin = pic.substring(0,pos-2);
			var pattern =/([a-zA-Z0-9]{1,20})$/;
			if(pattern.test(begin))
			{
				flagBegin = 1;
			}
			if(flagBegin == 1 && flagEnd == 1)
			{
				return 1;
			}
			else
			{
				return 0;
			}
		}

	function checkExist()
	{
        var xmlhttp = new XMLHttpRequest();
        var username = document.forms["RegisterForm"]["UserName"].value;
		        if((checkUserName(username, username.length)) == 1)
		        	{
		            var url = "CheckUsername?username=" + username;
		            xmlhttp.onreadystatechange = function(){
		                if(xmlhttp.readyState == 4 && xmlhttp.status == 200){
		                    if(xmlhttp.responseText.trim() == 'User already exists')
		                        document.getElementById("isE").style.color = "red";
		                    else
		                        document.getElementById("isE").style.color = "green";
		                    document.getElementById("isE").innerHTML = xmlhttp.responseText;
		                }
		                
		            };
		            try{
		            xmlhttp.open("post",url,true);
		            xmlhttp.send();
		        }catch(e){
		        	alert("unable to connect to server");
		        }
        	}
		        else
		        	{
		        	document.getElementById("isE").style.color = "red";
		        	document.getElementById('isE').innerHTML = "you entered username invalide";
		        	}
    }

	function checkPassword()
	{
		var password = document.forms["RegisterForm"]["Password"].value;
		var smallLetter = 0;
		var bigLetter = 0;
		var number = 0;
		for(var i = 0;i < password.length;i++)
		{
			if (/[a-z_]/.test(password[i]) == true) 
			{
				smallLetter++;
			}
			else if (/[A-Z_]/.test(password[i]) == true) 
			{
				bigLetter++;
			}
			else if (/[0-9_]/.test(password[i]) == true) 
			{
				number++;
			}
			
		}
		
		if(smallLetter == 0 || bigLetter == 0 || number == 0)
		{
        	document.getElementById("answerPassword").style.color = "red";
        	document.getElementById('answerPassword').innerHTML = "your password not contain a-z, A-Z, 0-9";
		}
		else
		{
        	document.getElementById('answerPassword').innerHTML = "";
		}
	}
	
	function checkEqual()
	{
		var password = document.forms["RegisterForm"]["Password"].value;
		var confirmPassword = document.forms["RegisterForm"]["ConfirmPassword"].value;
		
		if(password != confirmPassword)
		{
        	document.getElementById("confirmPassword").style.color = "red";
        	document.getElementById('confirmPassword').innerHTML = "Not the same password";
		}
		else
		{
			document.getElementById('confirmPassword').innerHTML = "";
		}
	}
</script>
</body>
</html>